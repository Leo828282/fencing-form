<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Fencing Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #b82429;
      text-align: center;
    }
    
    .form-container {
      margin-top: 20px;
    }
    
    .api-keys {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8f8f8;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    
    .api-keys h3 {
      margin-top: 0;
    }
    
    .api-key-input {
      display: flex;
      margin-bottom: 10px;
    }
    
    .api-key-input label {
      width: 200px;
      font-weight: bold;
    }
    
    .api-key-input input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    button {
      background-color: #b82429;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    
    button:hover {
      background-color: #a01f24;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Fencing Form Test</h1>
    
    <div class="api-keys">
      <h3>API Keys</h3>
      <div class="api-key-input">
        <label for="ghl-api-key">GoHighLevel API Key:</label>
        <input type="text" id="ghl-api-key" placeholder="Enter your GoHighLevel API Key">
      </div>
      <div class="api-key-input">
        <label for="ghl-location-id">GoHighLevel Location ID:</label>
        <input type="text" id="ghl-location-id" placeholder="Enter your GoHighLevel Location ID">
      </div>
      <button id="update-keys">Update API Keys</button>
    </div>
    
    <div class="form-container">
      <iframe 
        id="fencing-form"
        src="https://fencing-form-swtyvx.vercel.app/" 
        style="width: 100%; height: 765px; border: 0; outline: 0; box-shadow: none;" 
        frameborder="0" 
        allowtransparency="true"
        scrolling="no"
      ></iframe>
    </div>
  </div>
  
  <script>
    // Default API keys (replace with your actual keys)
    let apiKeys = {
      ghlApiKey: "",
      ghlLocationId: ""
    };
    
    // Load saved API keys from localStorage
    const savedKeys = localStorage.getItem('fencingFormApiKeys');
    if (savedKeys) {
      apiKeys = JSON.parse(savedKeys);
      document.getElementById('ghl-api-key').value = apiKeys.ghlApiKey;
      document.getElementById('ghl-location-id').value = apiKeys.ghlLocationId;
    }
    
    // Update API keys button
    document.getElementById('update-keys').addEventListener('click', function() {
      apiKeys = {
        ghlApiKey: document.getElementById('ghl-api-key').value,
        ghlLocationId: document.getElementById('ghl-location-id').value
      };
      
      // Save to localStorage
      localStorage.setItem('fencingFormApiKeys', JSON.stringify(apiKeys));
      
      // Reload iframe
      const iframe = document.getElementById('fencing-form');
      iframe.src = iframe.src;
      
      alert('API keys updated! The form will reload.');
    });
    
    // Inject API keys into iframe
    document.getElementById('fencing-form').onload = function() {
      const iframe = this;
      
      function injectApiKeys() {
        try {
          const iframeDoc = iframe.contentWindow.document;
          
          // Create script to inject API keys
          const script = document.createElement('script');
          script.id = 'api-keys-injector';
          script.textContent = `
            // Set environment variables
            window.process = window.process || {};
            window.process.env = window.process.env || {};
            window.process.env.GHL_API_KEY = "${apiKeys.ghlApiKey}";
            window.process.env.GHL_LOCATION_ID = "${apiKeys.ghlLocationId}";
            
            console.log("API Keys injected:", {
              GHL_API_KEY: window.process.env.GHL_API_KEY,
              GHL_LOCATION_ID: window.process.env.GHL_LOCATION_ID
            });
          `;
          
          // Add script to iframe
          if (!iframeDoc.getElementById('api-keys-injector')) {
            iframeDoc.head.appendChild(script);
          }
          
          // Resize iframe to match content
          iframe.style.height = (iframeDoc.body.scrollHeight + 50) + 'px';
          
        } catch (error) {
          console.error('Error injecting API keys:', error);
        }
      }
      
      // Initial injection
      setTimeout(injectApiKeys, 500);
      
      // Periodically check and inject
      setInterval(injectApiKeys, 2000);
      
      // Listen for messages from iframe
      window.addEventListener('message', function(event) {
        if (event.source === iframe.contentWindow) {
          // Handle form submission
          if (event.data.type === 'form-submitted') {
            alert('Form submitted successfully!');
          }
          
          // Handle form error
          if (event.data.type === 'form-error') {
            alert('Error submitting form: ' + event.data.error);
          }
          
          // Handle iframe resize
          if (event.data.type === 'resize-iframe') {
            iframe.style.height = event.data.height + 'px';
          }
        }
      });
    };
  </script>
</body>
</html>
