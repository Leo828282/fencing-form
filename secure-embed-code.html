<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fencing Calculator</title>
  <style>
    .fencing-form-container {
      width: 100%;
      max-width: 530px;
      margin: 0 auto;
      position: relative;
      height: 765px;
    }
    
    .fencing-form-iframe {
      width: 100%;
      height: 100%;
      border: 0;
      outline: 0;
      box-shadow: none;
      background: transparent;
      overflow: visible;
    }
  </style>
</head>
<body>
  <div class="fencing-form-container">
    <iframe 
      id="fencing-form-iframe"
      src="https://fencing-form-mzbpid.vercel.app/" 
      class="fencing-form-iframe"
      frameborder="0" 
      allowtransparency="true"
      scrolling="no"
      onload="setupIframe(this)"
    ></iframe>
  </div>

  <script>
    // Configuration - Replace these with your actual values if needed
    const CONFIG = {
      BOOKING_URL: process.env.NEXT_PUBLIC_BOOKING_URL || "YOUR_BOOKING_URL"
    };
    
    function setupIframe(iframe) {
      // Function to safely inject configuration
      function injectConfig() {
        try {
          const iframeWindow = iframe.contentWindow;
          if (!iframeWindow) return;
          
          // Create a secure way to pass configuration without exposing in DOM
          iframeWindow.postMessage({
            type: 'SETUP_CONFIG',
            config: {
              BOOKING_URL: CONFIG.BOOKING_URL
            }
          }, '*');
          
          // Adjust iframe height
          adjustIframeHeight(iframe);
        } catch (error) {
          console.error('Error setting up iframe:', error);
        }
      }
      
      // Adjust iframe height based on content
      function adjustIframeHeight(iframe) {
        try {
          const height = Math.max(765, iframe.contentWindow.document.body.scrollHeight + 50);
          iframe.style.height = height + 'px';
        } catch (e) {
          console.log('Could not adjust height', e);
        }
      }
      
      // Initial setup
      setTimeout(injectConfig, 500);
      
      // Periodically check and adjust
      setInterval(() => {
        adjustIframeHeight(iframe);
      }, 1000);
      
      // Listen for messages from the iframe
      window.addEventListener('message', function(event) {
        // Handle resize requests
        if (event.data && event.data.type === 'resize-iframe') {
          iframe.style.height = (event.data.height + 20) + 'px';
        }
        
        // Handle form submission success
        if (event.data && event.data.type === 'form-submitted') {
          console.log('Form submitted successfully:', event.data.contactId);
          // You can add custom success handling here
        }
        
        // Handle form submission errors
        if (event.data && event.data.type === 'form-error') {
          console.error('Form submission error:', event.data.error);
          // You can add custom error handling here
        }
        
        // Handle API key requests
        if (event.data && event.data.type === 'REQUEST_CONFIG') {
          injectConfig();
        }
      });
    }
  </script>
</body>
</html>
